<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 flex items-center justify-center">

<div class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl p-8">

    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Programming Quiz</h1>
        <p class="text-gray-500 mt-2">Choose the correct answer</p>
    </div>

    <!-- Progress -->
    <div class="mb-6">
        <div class="flex justify-between text-sm text-gray-500 mb-2">
            <span id="progressText">Question 1</span>
            <span id="totalQuestions">Total: 0</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="progressBar"
                 class="bg-indigo-600 h-2 rounded-full transition-all"></div>
        </div>
    </div>

    <!-- Question -->
    <div id="question"
         class="text-xl font-semibold text-gray-800 mb-6">
        Question text
    </div>

    <!-- Form -->
    <form method="post" action="{% url 'score' %}" id="quizForm">
        {% csrf_token %}
        <input type="hidden" name="q_id[]" id="q_id">

        <!-- Options injected here -->
        <div id="options" class="space-y-4"></div>

        <!-- Buttons -->
        <div class="mt-8 flex justify-between">
            <button type="button" id="backBtn"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-8 py-3 rounded-xl font-medium disabled:opacity-40 disabled:cursor-not-allowed transition"
                    disabled>
                ← Back
            </button>

            <button type="button" id="nextBtn"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-medium disabled:opacity-40 disabled:cursor-not-allowed transition"
                    disabled>
                Next →
            </button>

            <button type="button" id="submitBtn"
                    class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-xl font-medium hidden transition">
                Submit ✔
            </button>
        </div>
    </form>

</div>

<script>
    /* ===============================
       Django data
       =============================== */
    const quizData = {{ quiz_data|safe }}; // Replace with your Django context

    /* ===============================
       State
       =============================== */
    let currentIndex = 0;
    let selectedOption = null;
    const userAnswers = {};

    /* ===============================
       Elements
       =============================== */
    const questionEl = document.getElementById("question");
    const q_id = document.getElementById("q_id");
    const optionsEl = document.getElementById("options");
    const nextBtn = document.getElementById("nextBtn");
    const backBtn = document.getElementById("backBtn");
    const submitBtn = document.getElementById("submitBtn");
    const progressText = document.getElementById("progressText");
    const totalQuestions = document.getElementById("totalQuestions");
    const progressBar = document.getElementById("progressBar");
    const quizForm = document.getElementById("quizForm");

    totalQuestions.textContent = `Total: ${quizData.length}`;

    /* ===============================
       Render Question
       =============================== */
    function renderQuestion() {
        const q = quizData[currentIndex];
        selectedOption = userAnswers[q.id] ?? null;

        questionEl.textContent = q.question;
        q_id.value = q.id;

        progressText.textContent = `Question ${currentIndex + 1}`;
        progressBar.style.width = `${((currentIndex + 1) / quizData.length) * 100}%`;

        // Clear old options
        optionsEl.innerHTML = "";

        // Add new options
        q.options.forEach((option, index) => {
            const checked = selectedOption === index ? "checked" : "";
            optionsEl.insertAdjacentHTML("beforeend", `
                <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:bg-indigo-50 transition">
                    <input type="radio" name="option" value="${index}" ${checked}
                           class="w-5 h-5 accent-indigo-600">
                    <span class="text-gray-700 text-lg">${option}</span>
                </label>
            `);
        });

        // Event listener for option selection
        document.querySelectorAll("input[name='option']").forEach(input => {
            input.addEventListener("change", () => {
                selectedOption = parseInt(input.value);
                userAnswers[q.id] = selectedOption;
                nextBtn.disabled = false;
            });
        });

        // Back button state
        backBtn.disabled = currentIndex === 0;

        // Next/Submit buttons
        nextBtn.disabled = selectedOption === null;
        if (currentIndex === quizData.length - 1) {
            nextBtn.classList.add("hidden");
            submitBtn.classList.remove("hidden");
        } else {
            nextBtn.classList.remove("hidden");
            submitBtn.classList.add("hidden");
        }
    }

    /* ===============================
       Button Events
       =============================== */
    backBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
            currentIndex--;
            renderQuestion();
        }
    });

    nextBtn.addEventListener("click", () => {
        if (selectedOption === null) return;
        currentIndex++;
        renderQuestion();
    });

    submitBtn.addEventListener("click", () => {
        // Append user answers as hidden inputs
        for (const [qId, ans] of Object.entries(userAnswers)) {
            const input = document.createElement("input");
            input.type = "hidden";
            input.name = "answers[]";
            input.value = `${qId}:${ans}`;
            quizForm.appendChild(input);
        }
        quizForm.submit();
    });

    /* ===============================
       Init
       =============================== */
    renderQuestion();
</script>

</body>
</html>
