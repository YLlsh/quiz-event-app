<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- Header -->
<header class="bg-indigo-600 text-white p-4 flex justify-between items-center">
    <h1 class="text-lg font-bold">Admin Dashboard</h1>
    <a href="{% url 'log_out' %}">
        <button type="button"
                class="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg text-white font-medium">
            Logout
        </button>
    </a>
</header>

<!-- Main -->
<main class="p-8 max-w-6xl mx-auto">

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <!-- Buttons -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <button onclick="openModal('quizModal')"
              class="bg-white shadow rounded-xl p-6 hover:shadow-lg">
          ‚ûï Add Quiz
      </button>

      <button onclick="openModal('questionModal')"
              class="bg-white shadow rounded-xl p-6 hover:shadow-lg">
          ‚ùì Add Question
      </button>

      <button onclick="openModal('eventModal')"
              class="bg-white shadow rounded-xl p-6 hover:shadow-lg">
          üìÖ Add Event
      </button>
  </div>
</main>

<!-- ================= ADD QUIZ MODAL ================= -->
<div id="quizModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl w-full max-w-md p-6">
        <h2 class="text-xl font-bold mb-4">Add Quiz</h2>
        <form method="post" action="{% url 'add_quiz' %}">
            {% csrf_token %}
            <input type="text" name="quiz_name" required
                   placeholder="Enter Quiz Name"
                   class="w-full border rounded-lg px-4 py-3 mb-4">

            <input type="text" name="description" required
                   placeholder="Enter description"
                   class="w-full border rounded-lg px-4 py-3 mb-4">

            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeModal('quizModal')"
                        class="px-4 py-2 bg-gray-200 rounded-lg">
                    Cancel
                </button>
                <button type="submit"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg">
                    Save
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ================= ADD QUESTION MODAL ================= -->
<div id="questionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 overflow-y-auto flex justify-center pt-10">
    <div class="bg-white rounded-2xl w-full max-w-3xl p-6 mb-10">
        <h2 class="text-xl font-bold mb-1">Add Question</h2>

        <form method="post" action="{% url 'add_question' %}" id="questionForm">
            {% csrf_token %}

            <!-- Select Quiz -->
            <select name="quiz_id" required class="w-full border rounded-lg px-4 py-3 mb-4">
                <option value="">Select Quiz</option>
                {% for quiz in quiz_data %}
                    <option value="{{ quiz.id }}">{{ quiz.title }}</option>
                {% endfor %}
            </select>

            <!-- Select Question Type -->
            <select name="q_type" required class="w-full border rounded-lg px-4 py-3 mb-4">
                <option value="">Select Question Type</option>
                <option value="MCQ">MCQ</option>
                <option value="TF">True/False</option>
            </select>

            <!-- Question -->
            <textarea name="question"
                      placeholder="Enter Question"
                      class="w-full border rounded-lg px-4 py-3 mb-4"
                      required></textarea>

            <!-- Answers -->
            <div id="answersContainer" class="space-y-3">
                <div class="flex items-center gap-3 answer-item">
                    <input type="hidden" name="correct_answer[]" value="0">
                    <input type="radio" name="select_correct" class="correct-radio">
                    <input type="text" name="answers[]" placeholder="Answer option" class="w-full border rounded-lg px-3 py-2" required>
                </div>
            </div>

            <!-- Add Answer Button -->
            <button type="button" onclick="addAnswer()"
                    class="mt-4 text-indigo-600 font-medium">
                ‚ûï Add Answer
            </button>

            <!-- Footer -->
            <div class="flex justify-end mt-6 gap-3">
                <button type="button" onclick="closeModal('questionModal')"
                        class="px-4 py-2 bg-gray-200 rounded-lg">
                    Close
                </button>
                <button type="submit"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg">
                    Save Question
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ================= ADD EVENT MODAL ================= -->
<div id="eventModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl w-full max-w-md p-6">
        <h2 class="text-xl font-bold mb-4">Add Event</h2>
        <form method="post">
            {% csrf_token %}
            <input type="text" name="event_title" required
                   placeholder="Event Title"
                   class="w-full border rounded-lg px-4 py-3 mb-3">
            <input type="date" name="event_date" required
                   class="w-full border rounded-lg px-4 py-3 mb-3">
            <input type="text" name="event_location" required
                   placeholder="Event Location"
                   class="w-full border rounded-lg px-4 py-3 mb-3">
            <input type="text" name="event_label"
                   placeholder="Event Label (Optional)"
                   class="w-full border rounded-lg px-4 py-3 mb-4">
            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeModal('eventModal')"
                        class="px-4 py-2 bg-gray-200 rounded-lg">
                    Cancel
                </button>
                <button type="submit"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg">
                    Save Event
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
function openModal(id) {
    document.getElementById(id).classList.remove("hidden");
}

function closeModal(id) {
    document.getElementById(id).classList.add("hidden");
}

let answerIndex = 1;

// ================= ADD ANSWER =================
function addAnswer() {
    const container = document.getElementById("answersContainer");

    const div = document.createElement("div");
    div.className = "flex items-center gap-3 answer-item";

    div.innerHTML = `
        <input type="hidden" name="correct_answer[]" value="0">
        <input type="radio" name="select_correct" class="correct-radio">
        <input type="text" name="answers[]" placeholder="Answer option" class="w-full border rounded-lg px-3 py-2" required>
    `;

    container.appendChild(div);
    answerIndex++;
}

// ================= SET RADIO VALUES ON SUBMIT =================
document.getElementById('questionForm').addEventListener('submit', function() {
    const radios = document.querySelectorAll('.correct-radio');
    radios.forEach((radio) => {
        const hiddenInput = radio.parentElement.querySelector('input[type="hidden"]');
        hiddenInput.value = radio.checked ? "1" : "0";
    });
});
</script>

</body>
</html>
